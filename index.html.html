<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jorn Sports Analytics - An√°lise Preditiva de Performance</title>
   <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>JORN SPORTS</h1>
            <div class="subtitle">Sistema Preditivo de Performance Esportiva</div>
        </div>

        <div class="error-message" id="errorMessage"></div>

        <div class="form-container">
            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon">üë§</div>
                    <div class="section-title">Perfil Biom√©trico</div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="nome">Identifica√ß√£o do Atleta</label>
                        <input type="text" id="nome" class="form-input" placeholder="Nome completo" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="idade">Idade Cronol√≥gica</label>
                        <input type="number" id="idade" class="form-input" min="12" max="80" placeholder="Anos" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="sexo">Perfil Biol√≥gico</label>
                        <select id="sexo" class="form-select" required>
                            <option value="">Selecione o perfil...</option>
                            <option value="masculino">Masculino</option>
                            <option value="feminino">Feminino</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="experiencia">N√≠vel de Expertise</label>
                        <select id="experiencia" class="form-select" required>
                            <option value="">Avalie sua experi√™ncia...</option>
                            <option value="iniciante">Novato (0-1 ano)</option>
                            <option value="intermediario">Desenvolvido (1-3 anos)</option>
                            <option value="avancado">Avan√ßado (3+ anos)</option>
                            <option value="atleta">Elite Competitiva</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon">üìè</div>
                    <div class="section-title">An√°lise Antropom√©trica</div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="altura">Estatura (cm)</label>
                        <input type="number" id="altura" class="form-input" min="140" max="220" placeholder="Altura em cent√≠metros" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="peso">Massa Corporal (kg)</label>
                        <input type="number" id="peso" class="form-input" min="40" max="200" step="0.1" placeholder="Peso em quilogramas" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="envergadura">Envergadura (cm) <span class="optional-label">(Opcional)</span></label>
                        <input type="number" id="envergadura" class="form-input" min="140" max="250" placeholder="Abertura dos bra√ßos">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="percentualGordura">Composi√ß√£o Corporal (%) <span class="optional-label">(Opcional)</span></label>
                        <input type="number" id="percentualGordura" class="form-input" min="5" max="50" step="0.1" placeholder="% de gordura corporal">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon">‚ö°</div>
                    <div class="section-title">Capacidades F√≠sicas</div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="forca">Pot√™ncia Muscular</label>
                        <select id="forca" class="form-select" required>
                            <option value="">Avalie sua for√ßa...</option>
                            <option value="1">1 - M√≠nima</option>
                            <option value="2">2 - Muito Baixa</option>
                            <option value="3">3 - Baixa</option>
                            <option value="4">4 - Abaixo da M√©dia</option>
                            <option value="5">5 - M√©dia</option>
                            <option value="6">6 - Acima da M√©dia</option>
                            <option value="7">7 - Boa</option>
                            <option value="8">8 - Muito Boa</option>
                            <option value="9">9 - Excelente</option>
                            <option value="10">10 - Elite</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="resistencia">Sistema Cardiorrespirat√≥rio</label>
                        <select id="resistencia" class="form-select" required>
                            <option value="">Avalie sua resist√™ncia...</option>
                            <option value="1">1 - M√≠nima</option>
                            <option value="2">2 - Muito Baixa</option>
                            <option value="3">3 - Baixa</option>
                            <option value="4">4 - Abaixo da M√©dia</option>
                            <option value="5">5 - M√©dia</option>
                            <option value="6">6 - Acima da M√©dia</option>
                            <option value="7">7 - Boa</option>
                            <option value="8">8 - Muito Boa</option>
                            <option value="9">9 - Excelente</option>
                            <option value="10">10 - Elite</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="velocidade">Velocidade & Agilidade</label>
                        <select id="velocidade" class="form-select" required>
                            <option value="">Avalie sua velocidade...</option>
                            <option value="1">1 - M√≠nima</option>
                            <option value="2">2 - Muito Baixa</option>
                            <option value="3">3 - Baixa</option>
                            <option value="4">4 - Abaixo da M√©dia</option>
                            <option value="5">5 - M√©dia</option>
                            <option value="6">6 - Acima da M√©dia</option>
                            <option value="7">7 - Boa</option>
                            <option value="8">8 - Muito Boa</option>
                            <option value="9">9 - Excelente</option>
                            <option value="10">10 - Elite</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="flexibilidade">Flexibilidade & Coordena√ß√£o</label>
                        <select id="flexibilidade" class="form-select" required>
                            <option value="">Avalie sua flexibilidade...</option>
                            <option value="1">1 - M√≠nima</option>
                            <option value="2">2 - Muito Baixa</option>
                            <option value="3">3 - Baixa</option>
                            <option value="4">4 - Abaixo da M√©dia</option>
                            <option value="5">5 - M√©dia</option>
                            <option value="6">6 - Acima da M√©dia</option>
                            <option value="7">7 - Boa</option>
                            <option value="8">8 - Muito Boa</option>
                            <option value="9">9 - Excelente</option>
                            <option value="10">10 - Elite</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon">üß†</div>
                    <div class="section-title">Perfil Psicol√≥gico</div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="competitividade">Competitividade</label>
                        <select id="competitividade" class="form-select" required>
                            <option value="">Avalie sua competitividade...</option>
                            <option value="1">1 - Muito Baixa</option>
                            <option value="2">2 - Baixa</option>
                            <option value="3">3 - Moderada</option>
                            <option value="4">4 - Alta</option>
                            <option value="5">5 - Muito Alta</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="concentracao">Capacidade de Concentra√ß√£o</label>
                        <select id="concentracao" class="form-select" required>
                            <option value="">Avalie sua concentra√ß√£o...</option>
                            <option value="1">1 - Muito Baixa</option>
                            <option value="2">2 - Baixa</option>
                            <option value="3">3 - Moderada</option>
                            <option value="4">4 - Alta</option>
                            <option value="5">5 - Muito Alta</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="trabalhoEquipe">Trabalho em Equipe</label>
                        <select id="trabalhoEquipe" class="form-select" required>
                            <option value="">Prefer√™ncia de modalidade...</option>
                            <option value="individual">Prefiro esportes individuais</option>
                            <option value="pequeno">Pequenos grupos (2-5 pessoas)</option>
                            <option value="equipe">Esportes de equipe grandes</option>
                            <option value="ambos">Tanto individual quanto equipe</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="riscoTolerancia">Toler√¢ncia ao Risco</label>
                        <select id="riscoTolerancia" class="form-select" required>
                            <option value="">Avalie sua toler√¢ncia ao risco...</option>
                            <option value="1">1 - Muito Baixa (prefiro seguran√ßa)</option>
                            <option value="2">2 - Baixa</option>
                            <option value="3">3 - Moderada</option>
                            <option value="4">4 - Alta</option>
                            <option value="5">5 - Muito Alta (adoro desafios)</option>
                        </select>
                    </div>
                </div>
            </div>
<script>
function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

function faixaIMCPorEsporte(tagPeso){
  // Faixas amplas por tipo do seu DB
  if (tagPeso === "baixo") return [18.5, 21.5];
  if (tagPeso === "alto")  return [23.0, 26.5];
  return [20.0, 24.0]; // "medio"/default
}

function envergaduraRatio(alturaCm, envergaduraCm){
  if (!alturaCm || !envergaduraCm) return null;
  const ratio = envergaduraCm / alturaCm; // ex.: 1.05
  return Math.round(ratio * 1000) / 1000;
}

function scoreRangeMatch(value, [min, max], pesoMax){
  if (value == null) return pesoMax * 0.5; // aus√™ncia: meia pontua√ß√£o pra n√£o punir demais
  if (value >= min && value <= max) return pesoMax;
  const dist = (value < min) ? (min - value) : (value - max);
  // decai 1 ponto a cada 0.01 de raz√£o ou 5cm (dependendo do que passar)
  const step = (value < 3) ? 0.01 : 5; // heur√≠stica: raz√£o usa 0.01; cent√≠metros usam 5
  return clamp(pesoMax - (dist / step), 0, pesoMax);
}

// Salvar/Restaurar
function saveForm(){
  if (!document.getElementById('consent').checked) return;
  const ids = ["nome","idade","sexo","experiencia","altura","peso","envergadura","percentualGordura","forca","resistencia","velocidade","flexibilidade","competitividade","concentracao","trabalhoEquipe","riscoTolerancia"];
  const data = {};
  ids.forEach(id => data[id] = document.getElementById(id)?.value ?? null);
  localStorage.setItem("jornForm", JSON.stringify(data));
}

function restoreForm(){
  const raw = localStorage.getItem("jornForm");
  if (!raw) return;
  try{
    const data = JSON.parse(raw);
    Object.entries(data).forEach(([k,v])=>{
      const el = document.getElementById(k);
      if (el) el.value = v;
    });
  }catch(e){}
}

// Gr√°fico simples comparando atributos do TOP esporte
function drawAttrChart(ctx, user, sport){
  const labels = ["For√ßa","Resist√™ncia","Velocidade","Flexibilidade"];
  const userVals  = [user.forca, user.resistencia, user.velocidade, user.flexibilidade];
  const alvoVals  = [sport.physical.forca, sport.physical.resistencia, sport.physical.velocidade, sport.physical.flexibilidade];

  const W = ctx.canvas.width, H = ctx.canvas.height;
  ctx.clearRect(0,0,W,H);

  // layout b√°sico
  const left = 100, right = W - 30, top = 40, rowH = (H - top - 20) / labels.length;

  ctx.font = "14px Inter, sans-serif";
  ctx.fillStyle = "#b0b0b0";
  ctx.textBaseline = "middle";

  for(let i=0;i<labels.length;i++){
    const y = top + i*rowH + rowH/2;
    // label
    ctx.fillText(labels[i], 20, y);

    // trilho
    const x0 = left, x1 = right;
    ctx.globalAlpha = 0.25;
    ctx.fillStyle = "#00ffff";
    ctx.fillRect(x0, y-6, x1-x0, 12);
    ctx.globalAlpha = 1;

    // alvo
    const alvoPerc = clamp(alvoVals[i]/10, 0, 1);
    ctx.fillStyle = "#ff00ff";
    ctx.fillRect(x0, y-10, (x1-x0)*alvoPerc, 6);

    // usu√°rio
    const userPerc = clamp(userVals[i]/10, 0, 1);
    ctx.fillStyle = "#00ff00";
    ctx.fillRect(x0, y+2, (x1-x0)*userPerc, 6);

    // valores
    ctx.fillStyle = "#fff";
    ctx.fillText(`${userVals[i]}/10 vs ${alvoVals[i]}/10`, x1 - 120, y);
  }

  // legenda
  ctx.fillStyle = "#00ff00"; ctx.fillRect(left, H-18, 12, 12); ctx.fillStyle="#b0b0b0"; ctx.fillText("Voc√™", left+18, H-12);
  ctx.fillStyle = "#ff00ff"; ctx.fillRect(left+80, H-18, 12, 12); ctx.fillStyle="#b0b0b0"; ctx.fillText("Alvo do esporte", left+98, H-12);
}
</script>
            <button class="analyze-btn" onclick="analisarPerfil()">
                üöÄ ANALISAR PERFIL ESPORTIVO
            </button>
        </div>

        <div class="results" id="results">
        <div class="results-header">
  <h2>AN√ÅLISE COMPLETA Gerada</h2>
  <div class="subtitle">Relat√≥rio Preditivo de Performance</div>
  <div class="results-actions">
    <button class="secondary-btn" id="editBtn">‚úèÔ∏è Editar respostas</button>
    <button class="secondary-btn" id="savePdfBtn">üñ®Ô∏è Exportar PDF</button>
  </div>
</div>
<div class="results-content" id="resultsContent">
  <div class="loading">
    <div class="loading-spinner"></div>
    <div class="loading-text">Processando dados biom√©tricos...</div>
  </div>
  <div class="chart-wrap" style="display:none">
    <canvas id="attrChart" width="600" height="320" aria-label="Comparativo de atributos" role="img"></canvas>
  </div>
  <div id="methodNote" class="method-note" aria-live="polite"></div>
</div>
            </div>
        </div>
    </div>

    <script>
    // Base de dados cient√≠fica dos esportes
    const sportsDatabase = {
        "Nata√ß√£o": {
            anthropometry: { altura: [170, 190], envergadura: [1.05, 1.08], peso: "medio" },
            physical: { resistencia: 8, forca: 6, velocidade: 7, flexibilidade: 7 },
            psychological: { competitividade: 4, concentracao: 5, trabalhoEquipe: "individual", risco: 2 },
            description: "A nata√ß√£o √© um esporte de baixo impacto que desenvolve o sistema cardiovascular e a for√ßa muscular de forma equilibrada e sim√©trica. √â ideal para atletas que buscam um condicionamento completo sem sobrecarregar as articula√ß√µes.",
            benefits: ["Baixo impacto articular", "Desenvolvimento muscular sim√©trico", "Excelente condicionamento cardiovascular"],
            startingTips: ["Busque aulas com um instrutor qualificado para aprender a t√©cnica correta.", "Comece com uma frequ√™ncia de 2 a 3 vezes por semana.", "Concentre-se na t√©cnica da respira√ß√£o e dos movimentos antes de buscar velocidade."]
        },
        "Corrida de Velocidade": {
            anthropometry: { altura: [165, 185], peso: "baixo", muscular: "alta" },
            physical: { resistencia: 6, forca: 9, velocidade: 10, flexibilidade: 8 },
            psychological: { competitividade: 5, concentracao: 4, trabalhoEquipe: "individual", risco: 3 },
            description: "Modalidade explosiva do atletismo focada em atingir a velocidade m√°xima em curtas dist√¢ncias. Requer uma enorme pot√™ncia muscular, principalmente nos membros inferiores, e uma t√©cnica de corrida apurada.",
            benefits: ["Desenvolvimento de pot√™ncia muscular explosiva", "Melhora da velocidade m√°xima e acelera√ß√£o", "Queima cal√≥rica intensa em curtos per√≠odos"],
            startingTips: ["Um aquecimento extenso e din√¢mico √© obrigat√≥rio para prevenir les√µes.", "Incorpore treinos de for√ßa espec√≠ficos para pernas e core.", "A t√©cnica de corrida √© fundamental; considere a ajuda de um treinador."]
        },
        "Futebol": {
            anthropometry: { altura: [165, 185], peso: "medio", muscular: "media" },
            physical: { resistencia: 8, forca: 6, velocidade: 7, flexibilidade: 6 },
            psychological: { competitividade: 4, concentracao: 3, trabalhoEquipe: "equipe", risco: 3 },
            description: "O esporte mais popular do mundo, combina resist√™ncia para aguentar o jogo todo, piques de velocidade, habilidade t√©cnica com a bola e uma complexa intelig√™ncia t√°tica para o jogo coletivo.",
            benefits: ["Condicionamento f√≠sico completo (aer√≥bico e anaer√≥bico)", "Desenvolvimento de habilidades sociais e trabalho em equipe", "Melhora da coordena√ß√£o motora e agilidade"],
            startingTips: ["Participe de escolinhas ou grupos amadores para come√ßar.", "Desenvolva os fundamentos: passe, dom√≠nio de bola e chute.", "Jogue regularmente para desenvolver o entrosamento e a leitura de jogo."]
        },
        "Basquetebol": {
            anthropometry: { altura: [175, 210], envergadura: [1.05, 1.10], peso: "medio" },
            physical: { resistencia: 7, forca: 7, velocidade: 8, flexibilidade: 6 },
            psychological: { competitividade: 4, concentracao: 4, trabalhoEquipe: "equipe", risco: 2 },
            description: "Esporte din√¢mico e r√°pido que exige altura, impuls√£o, agilidade e excelente coordena√ß√£o. A capacidade de tomar decis√µes r√°pidas em um ambiente coletivo √© crucial.",
            benefits: ["Desenvolvimento de agilidade, reflexos e impuls√£o vertical", "Aprimoramento do trabalho em equipe e comunica√ß√£o", "Exige e desenvolve alta coordena√ß√£o motora e vis√£o de jogo"],
            startingTips: ["Treine os fundamentos: drible, arremesso e passe.", "Desenvolva a capacidade de saltar e a resist√™ncia para corridas curtas.", "Assista a jogos e aprenda sobre posicionamento t√°tico."]
        },
        "T√™nis": {
            anthropometry: { altura: [170, 190], peso: "medio", muscular: "media" },
            physical: { resistencia: 7, forca: 6, velocidade: 8, flexibilidade: 8 },
            psychological: { competitividade: 5, concentracao: 5, trabalhoEquipe: "individual", risco: 2 },
            description: "Esporte altamente t√©cnico e mental que combina pot√™ncia nos golpes, precis√£o, agilidade para cobrir a quadra e uma enorme resist√™ncia mental para manter o foco durante longas partidas.",
            benefits: ["Desenvolvimento de coordena√ß√£o olho-m√£o e agilidade", "Exige e aprimora a concentra√ß√£o e a resili√™ncia mental", "Combina exerc√≠cio aer√≥bico e anaer√≥bico"],
            startingTips: ["Fa√ßa aulas com um professor para aprender os golpes b√°sicos corretamente.", "Invista em uma raquete adequada para seu n√≠vel e tipo f√≠sico.", "Pratique a consist√™ncia dos movimentos antes de tentar aplicar for√ßa m√°xima."]
        },
        "V√¥lei": {
            anthropometry: { altura: [175, 200], envergadura: [1.05, 1.08], peso: "medio" },
            physical: { resistencia: 6, forca: 8, velocidade: 7, flexibilidade: 7 },
            psychological: { competitividade: 4, concentracao: 4, trabalhoEquipe: "equipe", risco: 2 },
            description: "Esporte coletivo que enfatiza o salto vertical (pot√™ncia), a coordena√ß√£o para os movimentos de ataque e defesa, e um forte senso de trabalho em equipe para a organiza√ß√£o t√°tica.",
            benefits: ["Desenvolvimento de grande pot√™ncia de salto e for√ßa de bra√ßos", "Melhora da coordena√ß√£o e tempo de rea√ß√£o", "Forte est√≠mulo ao trabalho em equipe e comunica√ß√£o"],
            startingTips: ["Treine o salto vertical e o fortalecimento do core.", "Desenvolva os fundamentos: saque, manchete e toque.", "Pratique a comunica√ß√£o constante com seus companheiros de equipe."]
        },
        "Ciclismo": {
            anthropometry: { altura: [160, 185], peso: "baixo", muscular: "pernas" },
            physical: { resistencia: 10, forca: 7, velocidade: 6, flexibilidade: 5 },
            psychological: { competitividade: 4, concentracao: 4, trabalhoEquipe: "individual", risco: 4 },
            description: "Esporte de resist√™ncia pura. Desenvolve um sistema cardiovascular extremamente eficiente e uma for√ßa muscular incr√≠vel nos membros inferiores, ideal para quem gosta de longos desafios e supera√ß√£o.",
            benefits: ["Excelente para o sistema cardiovascular com baixo impacto nas articula√ß√µes", "Fortalecimento massivo de pernas e gl√∫teos", "Permite explorar novos lugares e ter contato com a natureza"],
            startingTips: ["Invista em uma bicicleta do tamanho correto (bike fit).", "Comece com dist√¢ncias curtas e em terrenos planos, aumentando gradualmente.", "Sempre use equipamentos de seguran√ßa, especialmente o capacete."]
        },
        "Jud√¥": {
            anthropometry: { altura: [160, 185], peso: "variado", muscular: "alta" },
            physical: { resistencia: 7, forca: 9, velocidade: 6, flexibilidade: 9 },
            psychological: { competitividade: 4, concentracao: 5, trabalhoEquipe: "individual", risco: 3 },
            description: "Arte marcial japonesa que utiliza a for√ßa do oponente a seu favor. Desenvolve for√ßa funcional, flexibilidade para executar os movimentos e uma disciplina mental rigorosa baseada no respeito.",
            benefits: ["Desenvolvimento de for√ßa funcional e equil√≠brio", "Aprender t√©cnicas de autodefesa e disciplina", "Melhora da flexibilidade e consci√™ncia corporal"],
            startingTips: ["Procure um dojo com instrutores qualificados e credenciados.", "Aprenda a cair (ukemis) corretamente para evitar les√µes.", "Respeite a hierarquia de faixas e a filosofia do esporte."]
        },
        "Gin√°stica Art√≠stica": {
            anthropometry: { altura: [150, 170], peso: "baixo", muscular: "alta" },
            physical: { resistencia: 6, forca: 10, velocidade: 7, flexibilidade: 10 },
            psychological: { competitividade: 5, concentracao: 5, trabalhoEquipe: "individual", risco: 5 },
            description: "Modalidade que leva o corpo ao limite da for√ßa, flexibilidade e coordena√ß√£o. Exige um controle corporal excepcional, coragem para executar os movimentos e uma dedica√ß√£o extrema desde cedo.",
            benefits: ["Desenvolvimento de n√≠veis de elite de for√ßa relativa e flexibilidade", "Controle corporal e consci√™ncia espacial incompar√°veis", "Fomenta disciplina, foco e coragem"],
            startingTips: ["Idealmente, deve ser iniciado na inf√¢ncia.", "Treinamento sempre supervisionado por profissionais qualificados.", "O desenvolvimento √© gradual e exige paci√™ncia e muita repeti√ß√£o."]
        },
        "Atletismo - Meio Fundo": {
            anthropometry: { altura: [165, 180], peso: "baixo", muscular: "media" },
            physical: { resistencia: 9, forca: 6, velocidade: 8, flexibilidade: 6 },
            psychological: { competitividade: 5, concentracao: 4, trabalhoEquipe: "individual", risco: 2 },
            description: "Corridas de m√©dia dist√¢ncia (800m a 3000m) que exigem uma combina√ß√£o estrat√©gica de alta velocidade e grande resist√™ncia aer√≥bica. O atleta precisa saber dosar o ritmo para o sprint final.",
            benefits: ["Excelente desenvolvimento da resist√™ncia aer√≥bica e anaer√≥bica (VO2 m√°x)", "Desenvolvimento da velocidade de corrida e resist√™ncia √† fadiga", "Fortalecimento da disciplina mental e estrat√©gia de prova"],
            startingTips: ["Construa uma base aer√≥bica s√≥lida com treinos de rodagem.", "Incorpore treinos intervalados de alta intensidade para melhorar a velocidade.", "Aprenda a controlar seu ritmo (pacing) para n√£o quebrar no final."]
        },
        // ... (resto da sua base de dados permanece igual) ...
    };

    function calcularIMC(peso, altura) {
        if (!peso || !altura) return 0;
        const alturaMetros = altura / 100;
        return peso / (alturaMetros * alturaMetros);
    }

    function calcularCompatibilidade(userData, sportData) {
        let score = 0;
        let maxScore = 0;

       // An√°lise antropom√©trica (peso: 25%)
maxScore += 25;

// Altura (10 pts)
if (sportData.anthropometry.altura) {
  const [minAlt, maxAlt] = sportData.anthropometry.altura;
  score += scoreRangeMatch(userData.altura, [minAlt, maxAlt], 10);
}

// Envergadura (5 pts) ‚Äî se DB define como raz√£o esperada (ex.: 1.05‚Äì1.08) e usu√°rio informou
if (sportData.anthropometry.envergadura && userData.envergadura) {
  const [minRat, maxRat] = sportData.anthropometry.envergadura;
  const ratio = envergaduraRatio(userData.altura, userData.envergadura);
  score += scoreRangeMatch(ratio, [minRat, maxRat], 5);
} else {
  score += 2.5; // cr√©dito parcial se n√£o houver dado
}

// IMC por FAIXA (10 pts)
const imc = calcularIMC(userData.peso, userData.altura);
const [imcMin, imcMax] = faixaIMCPorEsporte(sportData.anthropometry.peso);
score += scoreRangeMatch(imc, [imcMin, imcMax], 10);
        // An√°lise das capacidades f√≠sicas (peso: 40%)
        maxScore += 40;
        const physicalDiff = (
            Math.abs(userData.forca - sportData.physical.forca) +
            Math.abs(userData.resistencia - sportData.physical.resistencia) +
            Math.abs(userData.velocidade - sportData.physical.velocidade) +
            Math.abs(userData.flexibilidade - sportData.physical.flexibilidade)
        );
        // A diferen√ßa m√°xima poss√≠vel √© 36 (4 * 9). Mapeamos isso para 40 pontos.
        score += Math.max(0, 40 - (physicalDiff * 1.1));

        // An√°lise psicol√≥gica (peso: 35%)
        maxScore += 35;
        const compDiff = Math.abs(userData.competitividade - sportData.psychological.competitividade);
        score += Math.max(0, 10 - compDiff * 2);

        const concDiff = Math.abs(userData.concentracao - sportData.psychological.concentracao);
        score += Math.max(0, 10 - concDiff * 2);

        let teamScore = 0;
        if (userData.trabalhoEquipe === sportData.psychological.trabalhoEquipe) {
            teamScore = 10;
        } else if (userData.trabalhoEquipe === "ambos") {
            teamScore = 7; // Bom para ambos os tipos
        } else if ((userData.trabalhoEquipe === 'pequeno' && sportData.psychological.trabalhoEquipe === 'equipe') ||
                   (userData.trabalhoEquipe === 'equipe' && sportData.psychological.trabalhoEquipe === 'pequeno')) {
            teamScore = 5; // Parcialmente compat√≠vel
        } else {
            teamScore = 2; // Incompat√≠vel
        }
        score += teamScore;

        const riskDiff = Math.abs(userData.riscoTolerancia - sportData.psychological.risco);
        score += Math.max(0, 5 - riskDiff);

        return Math.round((score / maxScore) * 100);
    }
    function analisarPerfil() {
        const userData = {
            nome: document.getElementById('nome').value,
            idade: parseInt(document.getElementById('idade').value),
            sexo: document.getElementById('sexo').value,
            experiencia: document.getElementById('experiencia').value,
            altura: parseInt(document.getElementById('altura').value),
            peso: parseFloat(document.getElementById('peso').value),
            envergadura: parseInt(document.getElementById('envergadura').value) || null,
            percentualGordura: parseFloat(document.getElementById('percentualGordura').value) || null,
            forca: parseInt(document.getElementById('forca').value),
            resistencia: parseInt(document.getElementById('resistencia').value),
            velocidade: parseInt(document.getElementById('velocidade').value),
            flexibilidade: parseInt(document.getElementById('flexibilidade').value),
            competitividade: parseInt(document.getElementById('competitividade').value),
            concentracao: parseInt(document.getElementById('concentracao').value),
            trabalhoEquipe: document.getElementById('trabalhoEquipe').value,
            riscoTolerancia: parseInt(document.getElementById('riscoTolerancia').value)
        };

        const requiredFields = ['nome', 'idade', 'sexo', 'experiencia', 'altura', 'peso', 'forca', 'resistencia', 'velocidade', 'flexibilidade', 'competitividade', 'concentracao', 'trabalhoEquipe', 'riscoTolerancia'];
        const errorMessage = document.getElementById('errorMessage');
        const resultsContainer = document.getElementById('results');
        const resultsContent = document.getElementById('resultsContent');
        const analyzeBtn = document.querySelector('.analyze-btn');

        let firstInvalidField = null;

        for (const field of requiredFields) {
            if (!userData[field] && userData[field] !== 0) { // Checa se √© nulo, undefined, NaN, ou string vazia
                firstInvalidField = document.getElementById(field);
                break;
            }
        }

        if (firstInvalidField) {
            errorMessage.textContent = 'ERRO: Todos os campos obrigat√≥rios devem ser preenchidos para a an√°lise.';
            errorMessage.style.display = 'block';
            firstInvalidField.focus();
            resultsContainer.style.display = 'none';
            return;
        }

        errorMessage.style.display = 'none';
        resultsContainer.style.display = 'block';
        resultsContent.innerHTML = `
            <div class="loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">Processando dados e consultando matriz de performance...</div>
            </div>`;
        analyzeBtn.disabled = true;
        resultsContainer.scrollIntoView({ behavior: 'smooth' });

        setTimeout(() => {
            const sportScores = [];
            for (const sportName in sportsDatabase) {
                const sportData = sportsDatabase[sportName];
                const score = calcularCompatibilidade(userData, sportData);
                sportScores.push({ name: sportName, score: score, details: sportData });
            }

            sportScores.sort((a, b) => b.score - a.score);

            const topSport = sportScores[0];
            const top5Sports = sportScores.slice(0, 5);

            let resultsHTML = `
                <div class="sport-recommendation">
                    <div class="section-header">
                        <div class="section-icon" style="background: linear-gradient(45deg, var(--accent-neon), var(--primary-neon));">üèÜ</div>
                        <div class="section-title" style="color: var(--accent-neon);">Top 5 Recomenda√ß√µes</div>
                    </div>
                    ${top5Sports.map(sport => `
                        <div class="sport-match">
                            <span class="sport-name">${sport.name}</span>
                            <div class="match-bar">
                                <div class="match-fill" style="width: ${sport.score}%;"></div>
                            </div>
                            <span class="match-percentage">${sport.score}%</span>
                        </div>
                    `).join('')}
                </div>

                <div class="attributes-grid">
                     <div class="attribute-card"><div class="attribute-label">For√ßa</div><div class="attribute-score">${userData.forca}/10</div></div>
                     <div class="attribute-card"><div class="attribute-label">Resist√™ncia</div><div class="attribute-score">${userData.resistencia}/10</div></div>
                     <div class="attribute-card"><div class="attribute-label">Velocidade</div><div class="attribute-score">${userData.velocidade}/10</div></div>
                     <div class="attribute-card"><div class="attribute-label">Flexibilidade</div><div class="attribute-score">${userData.flexibilidade}/10</div></div>
                </div>

                <div class="detailed-analysis">
                    <div class="analysis-section">
                        <div class="analysis-title">An√°lise Detalhada: ${topSport.name} (Compatibilidade de ${topSport.score}%)</div>
                        <p class="analysis-content">${topSport.details.description}</p>
                    </div>
                    <div class="analysis-section">
                        <div class="analysis-title">Principais Benef√≠cios para seu Perfil</div>
                        <p class="analysis-content">${topSport.details.benefits.join('. ')}.</p>
                    </div>
                </div>

                <div class="recommendations-section">
                     <h3 class="recommendations-title">Recomenda√ß√µes para Iniciar em ${topSport.name}</h3>
                     <ul class="recommendations-list">
                        ${topSport.details.startingTips.map(tip => `<li>${tip}</li>`).join('')}
                     </ul>
                </div>
            `;

            resultsContent.innerHTML = resultsHTML;
            analyzeBtn.disabled = false;
        }, 2000); // Simula 2 segundos de processamento
    }
</script>